<div class="relative">
    <div class="w-full h-full absolute inset-0 bg-gray-900 rounded-xl translate-y-2 translate-x-2"></div>
    <div class="rounded-xl relative z-20 p-8 sm:p-10 border-[3px] border-gray-900 bg-[#fff4da]">
        <img src="https://cdn.devdojo.com/images/january2023/shape-1.png"
             class="absolute md:block hidden left-0 h-[4.5rem] w-[4.5rem] bottom-0 -translate-x-full ml-3">
        
        <!-- Header -->
        <div class="mb-6 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Repository Analysis</h2>
            <p class="text-gray-700">Intelligently select the most relevant files for your needs</p>
        </div>
        
        <!-- Ingest Form -->
        <form id="ingestForm" method="post" onsubmit="handleSubmit(event, true)">
            <!-- Top row: repo URL + Ingest button -->
            <div class="flex md:flex-row flex-col w-full h-full justify-center items-stretch space-y-5 md:space-y-0 md:space-x-5">
                <!-- Repository URL Input -->
                <div class="relative w-full h-full">
                    <div class="w-full h-full rounded bg-gray-900 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                    <input type="text"
                           name="input_text"
                           id="input_text"
                           placeholder="https://github.com/..."
                           value="{{ repo_url if repo_url else '' }}"
                           required
                           class="border-[3px] w-full relative z-20 border-gray-900 placeholder-gray-600 text-lg font-medium focus:outline-none py-3.5 px-6 rounded bg-[#E8F0FE]">
                </div>
                <!-- Ingest button -->
                <div class="relative w-auto flex-shrink-0 h-full group">
                    <div class="w-full h-full rounded bg-gray-800 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                    <button type="submit"
                            class="py-3.5 rounded px-6 group-hover:-translate-y-px group-hover:-translate-x-px ease-out duration-300 z-20 relative w-full border-[3px] border-gray-900 font-medium bg-[#ffc480] tracking-wide text-lg flex-shrink-0 text-gray-900">
                        Ingest
                    </button>
                </div>
            </div>
            
            <!-- Controls row: prompt input, context size selector, PAT checkbox -->
            <div id="controlsRow"
                 class="mt-7 grid gap-6 grid-cols-1 lg:grid-cols-[2fr_1fr_1fr] lg:gap-y-0">
                
                <!-- User Prompt Input (Optional) -->
                <div class="w-full self-start">
                    <label for="user_prompt" class="block text-gray-700 mb-2 font-medium">
                        üéØ What are you looking for? (Optional)
                    </label>
                    <div class="relative">
                        <div class="w-full h-full rounded bg-gray-900 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                        <textarea name="user_prompt"
                                  id="user_prompt"
                                  placeholder="e.g., 'API endpoints and database models', 'frontend components and styling', 'configuration and deployment scripts'..."
                                  rows="3"
                                  class="border-[3px] w-full relative z-20 border-gray-900 placeholder-gray-600 text-sm font-medium focus:outline-none py-3 px-4 rounded bg-[#E8F0FE] resize-none">{{ user_prompt if user_prompt else '' }}</textarea>
                    </div>
                    <p class="text-xs text-gray-600 mt-1">
                        Leave empty for general-purpose analysis
                    </p>
                </div>
                
                <!-- Context Size Selector -->
                <div class="w-full self-start">
                    <label for="context_size_input" class="block text-gray-700 mb-2 font-medium">
                        üìè Context Size: <span id="context_size_display" class="font-bold">128k tokens</span>
                    </label>
                    
                    <!-- Slider -->
                    <div class="mb-3">
                        <input type="range"
                               id="context_size_slider"
                               min="1"
                               max="4"
                               step="1"
                               value="2"
                               class="w-full h-3 bg-[#FAFAFA] bg-no-repeat bg-[length:50%_100%] bg-[#ebdbb7] appearance-none border-[3px] border-gray-900 rounded-sm focus:outline-none bg-gradient-to-r from-[#FE4A60] to-[#FE4A60] [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-7 [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-sm [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:border-solid [&::-webkit-slider-thumb]:border-[3px] [&::-webkit-slider-thumb]:border-gray-900 [&::-webkit-slider-thumb]:shadow-[3px_3px_0_#000]">
                    </div>
                    
                    <!-- Editable Input -->
                    <div class="relative">
                        <div class="w-full h-full rounded bg-gray-900 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                        <div class="flex relative z-20 border-[3px] border-gray-900 rounded bg-white">
                            <input type="text"
                                   id="context_size_input"
                                   name="context_size"
                                   value="128k"
                                   placeholder="e.g. 128k, 500k, 1M"
                                   class="py-2 px-3 bg-[#E8F0FE] focus:outline-none w-full rounded text-sm font-medium">
                            <div class="flex items-center px-2 text-xs text-gray-600 bg-gray-50 border-l border-gray-300">
                                tokens
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preset buttons -->
                    <div class="flex flex-wrap gap-1 mt-2">
                        <button type="button" onclick="setContextSize('32k')" 
                                class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded transition-colors">32k</button>
                        <button type="button" onclick="setContextSize('128k')" 
                                class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded transition-colors">128k</button>
                        <button type="button" onclick="setContextSize('512k')" 
                                class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded transition-colors">512k</button>
                        <button type="button" onclick="setContextSize('1M')" 
                                class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded transition-colors">1M</button>
                    </div>
                    
                    <p class="text-xs text-gray-600 mt-1">
                        Use slider, type custom value, or click presets
                    </p>
                </div>
                
                <!-- PAT checkbox with PAT field -->
                <div class="flex flex-col items-start w-full">
                    <!-- PAT checkbox -->
                    <div class="flex items-center space-x-2 mb-2">
                        <label for="showAccessSettings"
                               class="flex gap-2 text-gray-900 cursor-pointer font-medium">
                            <div class="relative w-5 h-5 mt-0.5">
                                <input type="checkbox"
                                       id="showAccessSettings"
                                       onchange="toggleAccessSettings()"
                                       {% if token %}checked{% endif %}
                                       class="cursor-pointer peer appearance-none w-full h-full rounded-sm border-[2px] border-current bg-white m-0 text-current shadow-[2px_2px_0_currentColor]" />
                                <span class="absolute inset-0 w-2.5 h-2.5 m-auto scale-0 transition-transform duration-150 ease-in-out shadow-[inset_1rem_1rem_#FE4A60] bg-[CanvasText] origin-bottom-left peer-checked:scale-100"
                                      style="clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%)"></span>
                            </div>
                            üîí Private Repository
                        </label>
                    </div>
                    <!-- PAT field -->
                    <div id="accessSettingsContainer"
                         class="{% if not token %}hidden {% endif %}w-full">
                        <div class="relative w-full">
                            <div class="w-full h-full rounded bg-gray-900 translate-y-1 translate-x-1 absolute inset-0 z-10"></div>
                            <div class="flex relative z-20 border-[3px] border-gray-900 rounded bg-white">
                                <input id="token"
                                       type="password"
                                       name="token"
                                       placeholder="Personal Access Token"
                                       value="{{ token if token else '' }}"
                                       class="py-2 pl-3 pr-8 bg-[#E8F0FE] focus:outline-none w-full rounded text-sm">
                                <!-- Info icon with tooltip -->
                                <span class="absolute right-3 top-1/2 -translate-y-1/2">
                                    <svg class="w-4 h-4 text-gray-600 cursor-pointer peer"
                                         xmlns="http://www.w3.org/2000/svg"
                                         fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor"
                                         stroke-width="2">
                                        <circle cx="12" cy="12" r="10" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 16v-4m0-4h.01" />
                                    </svg>
                                    <!-- Tooltip -->
                                    <div class="absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs leading-tight py-1 px-2 rounded shadow-lg opacity-0 pointer-events-none peer-hover:opacity-100 peer-hover:pointer-events-auto transition-opacity duration-200 whitespace-nowrap">
                                        Secure ‚Ä¢ Never stored ‚Ä¢ Used once only
                                    </div>
                                </span>
                            </div>
                        </div>
                        <!-- Help section -->
                        <div class="mt-2 flex items-center space-x-1">
                            <a href="https://github.com/settings/tokens/new?description=gitingest&scopes=repo"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="text-xs text-gray-600 hover:text-gray-800 flex items-center space-x-1 underline">
                                <span>Get your token</span>
                                <svg class="w-3 h-3"
                                     fill="none"
                                     stroke="currentColor"
                                     viewBox="0 0 24 24"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Features Notice -->
            <div class="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
                <div class="flex items-center space-x-2 mb-2">
                    <span class="text-blue-600 text-lg">‚ú®</span>
                    <h3 class="font-semibold text-blue-800">Smart Features</h3>
                </div>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>‚Ä¢ <strong>Smart File Selection:</strong> Automatically selects the most relevant files</li>
                    <li>‚Ä¢ <strong>Context-Aware:</strong> Results tailored to your specific prompt and requirements</li>
                    <li>‚Ä¢ <strong>Optimal Size:</strong> Content automatically sized to your chosen context window</li>
                </ul>
            </div>
        </form>
        
        <!-- Example repositories section -->
        {% if show_examples %}
            <div id="exampleRepositories" class="mt-6">
                <p class="opacity-70 mb-3 font-medium">Try these example repositories:</p>
                <div class="flex flex-wrap gap-2">
                    {% for example in examples %}
                        <button onclick="submitExample('{{ example.url }}')"
                                class="px-4 py-2 bg-[#EBDBB7] hover:bg-[#FFC480] text-gray-900 rounded transition-colors duration-200 border-[3px] border-gray-900 relative hover:-translate-y-px hover:-translate-x-px text-sm font-medium">
                            {{ example.name }}
                        </button>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script defer src="/static/js/git.js"></script>
<script defer src="/static/js/utils_ai.js"></script>
<script defer src="/static/js/git_form_ai.js"></script>